# 🎯 IBS 통합 견적 관리 시스템 설정 가이드

## 📋 개요
견적서 → 거래명세서 → 인보이스 완전 연동 시스템

## 🚀 주요 기능
1. **견적서 작성 및 구글시트 저장**
2. **거래명세서에서 견적번호로 데이터 불러오기**
3. **인보이스에서 견적번호로 데이터 불러오기**
4. **실시간 Analytics Widget (개선된 안정성)**

## 📊 시스템 구조

### 구글시트 구조:
- `IBS_견적서_목록` (메인 견적서 데이터)
- `IBS_거래명세서_목록` (거래명세서 데이터)
- `IBS_인보이스_목록` (인보이스 데이터)
- `IBS_통계_대시보드` (통계 및 분석)

### 데이터 흐름:
```
견적서 작성 → 구글시트 저장
     ↓
거래명세서 → 견적번호 선택 → 자동 데이터 채우기
     ↓
인보이스 → 견적번호 선택 → 자동 데이터 채우기
```

## 🔧 설정 단계

### 1단계: Google Apps Script 배포

1. **통합 스크립트 생성**
   - Google Apps Script 새 프로젝트 생성
   - `integrated_quotation_system.js` 내용 복사
   - 스프레드시트 ID 확인 및 설정

2. **배포 설정**
   ```javascript
   const SPREADSHEET_ID = '1MUHiU8a0p1aBs0wU94gmmlugwmB9qSYO8NLl-qZ9-ho';
   ```

3. **웹 앱으로 배포**
   - 배포 → 새 배포
   - 유형: 웹 앱
   - 실행 계정: 나
   - 액세스 권한: 모든 사용자
   - 배포 URL 복사

### 2단계: HTML 파일 URL 업데이트

각 HTML 파일에서 다음 부분을 찾아 새 배포 URL로 교체:

```javascript
// 기존
const INTEGRATED_API_URL = 'https://script.google.com/macros/s/YOUR_NEW_INTEGRATED_SCRIPT_URL/exec';

// 새로운 배포 URL로 교체
const INTEGRATED_API_URL = 'https://script.google.com/macros/s/[새로운_배포_URL]/exec';
```

**업데이트 필요한 파일:**
- `ibs_quotation_improved.html`
- `interactive_delivery_statement.html`
- `professional_invoice_a4_optimized.html`

### 3단계: 기능 테스트

1. **견적서 작성 테스트**
   - 견적서 작성 후 구글시트 저장
   - 구글시트에서 데이터 확인

2. **거래명세서 연동 테스트**
   - 거래명세서 페이지 열기
   - 견적서 선택 드롭다운에서 견적번호 확인
   - 견적번호 선택 후 자동 데이터 채우기 확인

3. **인보이스 연동 테스트**
   - 인보이스 페이지 열기
   - 견적서 선택 후 자동 데이터 채우기 확인

4. **Analytics Widget 테스트**
   - 각 페이지의 Analytics Widget 동작 확인
   - 5초 타임아웃 후 안정적 동작 확인

## 🔍 문제 해결

### 견적서 목록이 안 보이는 경우:
1. Google Apps Script 배포 URL 확인
2. 스프레드시트 ID 확인
3. 브라우저 콘솔에서 오류 메시지 확인

### Analytics Widget 연결 실패:
1. 5초 타임아웃 후 "⏰ 연결 시간초과" 표시 정상
2. "🔄 새로고침" 버튼으로 재시도 가능
3. 오프라인에서도 기본값으로 동작

### 데이터 자동 채우기 실패:
1. 견적서가 구글시트에 저장되었는지 확인
2. 견적번호 형식 확인 (IBS-YYYYMM-XXX)
3. 브라우저 콘솔에서 API 응답 확인

## 📈 개선사항

### ✅ 해결된 문제들:
1. **Analytics Widget 멈춤 현상** → 5초 타임아웃 + AbortController로 해결
2. **견적서 연동 부재** → 구글시트 기반 완전 연동 시스템 구축
3. **데이터 흐름 단절** → 견적서 → 거래명세서 → 인보이스 연결

### 🚀 새로운 기능들:
1. **실시간 견적서 목록** - 구글시트에서 자동 로드
2. **원클릭 데이터 연동** - 견적번호 선택만으로 모든 데이터 자동 채우기
3. **안정적인 Analytics** - 타임아웃 처리로 멈춤 현상 해결
4. **상태 표시 개선** - 연결 상태를 명확히 표시

## 🎯 사용 방법

### 일반적인 워크플로우:
1. **견적서 작성** → 구글시트 저장
2. **거래명세서 작성** → 견적번호 선택 → 자동 채우기 → 저장
3. **인보이스 작성** → 견적번호 선택 → 자동 채우기 → 저장

### 각 단계별 세부사항:
- 견적서: 프로젝트 정보, 고객 정보, 견적 항목 입력
- 거래명세서: 견적서 데이터 기반으로 거래 조건 추가
- 인보이스: 견적서 데이터 기반으로 결제 정보 추가

## 📞 지원

문제가 발생하면 다음을 확인해주세요:
1. 브라우저 개발자 도구 콘솔 메시지
2. Google Apps Script 실행 로그
3. 구글시트 데이터 상태

---
**마지막 업데이트:** 2025년 1월 16일  
**버전:** 2.0 (통합 연동 시스템) 